<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Button Tree 2023</title>
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet" />
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Pacifico&display=swap" rel="stylesheet">
    <!-- MDB -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/mdb-ui-kit/6.0.1/mdb.min.css" rel="stylesheet" />

    <style>
        html {
            height: 100vh;
        }
        body {
            position: fixed;
            margin: 0;
            padding: 0.2rem 0.1rem 0 0.1rem;
            width: 100%;
            height: 100%;
            background: #333333;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            /*gap: 0.4rem;*/
            overflow: hidden;
        }

        #banner {
            font-family: 'Pacifico', cursive;
            text-align: center;
            font-size: 3.2rem;
        }

        #year {
            font-family: 'Pacifico', cursive;
            text-align: center;
            font-size: 4.2rem;
        }

        #tree {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            /*flex-grow: 1;*/
            gap: 0.3rem;
        }
        .tree-row {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            gap: 0.2rem;
        }
        .tree-btn {
            padding-left: 2px;
            padding-right: 2px;
            opacity: 0.7;
        }

        .star-glow {
            color: #fff200;
            text-shadow:
                0 0 4px #fff,
                0 0 60px #fff200,
                0 0 100px #fff200
        }

        .neon-text-1 {
            color: #fff;
            font-weight: 200;
            text-shadow:
                0 0 4px #fff,
                0 0 10px #fff,
                0 0 40px #f09,
                0 0 60px #f09,
                0 0 80px #f09,
                0 0 90px #f09,
                0 0 100px #f09,
                0 0 150px #f09;
        }

        .neon-text-flicker-1 {
            color: #fff;
            font-weight: 200;
            animation: flicker-1 2.1s infinite alternate;
        }

        @keyframes flicker-1 {
            0%, 18%, 22%, 25%, 53%, 57%, 100% {
                text-shadow:
                    0 0 4px #fff,
                    0 0 10px #fff,
                    0 0 40px #f09,
                    0 0 60px #f09,
                    0 0 80px #f09,
                    0 0 90px #f09,
                    0 0 100px #f09,
                    0 0 150px #f09;
            }
            20%, 24%, 55% {
                text-shadow: none;
            }
        }

        .neon-text-2 {
            color: #fff;
            font-weight: 200;
            text-shadow:
                0 0 4px #fff,
                0 0 10px #fff,
                0 0 40px #00FFD9,
                0 0 60px #00FFD9,
                0 0 80px #00FFD9,
                0 0 90px #00FFD9,
                0 0 100px #00FFD9;
        }

        .neon-text-flicker-2 {
            color: #fff;
            font-weight: 200;
            animation: flicker-2 2.2s infinite alternate;
        }

        @keyframes flicker-2 {
            0%, 18%, 22%, 25%, 53%, 57%, 100% {
                text-shadow:
                        0 0 4px #fff,
                        0 0 10px #fff,
                        0 0 40px #00FFD9,
                        0 0 60px #00FFD9,
                        0 0 80px #00FFD9,
                        0 0 90px #00FFD9,
                        0 0 100px #00FFD9,
                        0 0 150px #00FFD9;
            }
            20%, 24%, 55% {
                text-shadow: none;
            }
        }

        .stem-btn {
            background: #664133;
        }

        @keyframes grow-font {
            100% {
                font-size: 6rem;
            }
        }

        .gift {
            color: #b7183c;
            font-size: 2.9rem;
            transform: translate(-50%, 0%);
            animation: grow-font 0.5s alternate-reverse;
        }

        .cat {
            font-size: 3.1rem;
            color: #999999;
            transform: translate(-50%, 0%);
            animation: grow-font 0.5s alternate-reverse;
        }

        .ball {
            font-size: 1.1rem;
        }

        .ball-1 {
            color: #fff200;
            text-shadow: 0 0 35px #fff200;
        }
        .ball-2 {
            color: #ff0044;
            text-shadow: 0 0 35px #ff0044;
        }
        .ball-3 {
            color: #00B2FF;
            text-shadow: 0 0 35px #00B2FF;
        }
        .ball-4 {
            color: #DD00FF;
            text-shadow: 0 0 35px #DD00FF;
        }
        .ball-5 {
            color: #00ff15;
            text-shadow: 0 0 35px #00ff15;
        }
        .ball-6 {
            color: #ffffff;
            text-shadow: 0 0 35px #ffffff;
        }

        .wish {
            pointer-events: none;
            font-size: 1rem;
            font-weight: 400;
            color: white;
            /*text-shadow: 0 0 30px #ffffff;*/
            white-space: nowrap;
            position: absolute;
            /*top: 50%;*/
            /*left: 50%;*/
            transform: translate(-50%, -50%);
            animation: grow-away 1.4s;
        }
        @keyframes grow-away {
            0% {
                font-size: 1rem;
                opacity: 1;
            }
            50% {
                opacity: 0.7;
            }
            100% {
                font-size: 9rem;
                opacity: 0;
            }
        }
    </style>
</head>
<body>
<div id="banner" class="neon-text-1 invisible">С НОВЫМ<br/>ГОДОМ!</div>
<div id="tree" style="position: relative"></div>
<div id="bottom" style="min-height: 15%">
    <div id="year" class="d-none neon-text-2">2023</div>
    <div id="control" class="vstack align-items-center gap-1">
        <div class="fs-4" style="color:white">Раз, два, три...</div>
        <button type="button" class="btn btn-primary" onclick="light()">Enable Button Tree</button>
    </div>
</div>
<script>
    // utils
    function random(min, max) {
        return Math.round(min + (max-min)*Math.random());
    }

    function pickRandom(array) {
        if (array && array.length) {
            return array[random(0, array.length-1)];
        }
        return null;
    }

    function pickCycle(array, start = 0) {
        let i = start;
        return function next() {
            if (i > array.length-1) {
                i = 0;
            }
            return array[i++];
        }
    }

    function delay(period) {
        return new Promise((res) => setTimeout(res, period));
    }
</script>
<script>
    const labels = ['OK', 'YES', 'NEXT', 'RUN', 'НЕТ', 'ДА'];
    const icons = ['fa-circle', 'fa-question-circle', 'fa-exclamation-circle', 'fa-minus-circle', 'fa-plus-circle', 'fa-check-circle', 'fa-times-circle'];
    const balls = [1,2,3,4,5,6].map(i => `ball-${i}`);
    const nextBall = pickCycle(balls);
    const wishes = [
        'здоровья', 'удачи', 'счастья', 'приключений', 'радости', 'терпенья', 'силы', 'бодрости', 'вдохновения'
    ];
    const nextWish = pickCycle(wishes, random(0, wishes.length-1));
    const HEIGHT = 9;

    function generateTreeHtml() {
        const F = 1 / 3.2;
        let html = '<i id="star" class="fas fa-4x fa-exclamation-triangle"></i>';
        const nextIcon = pickCycle(icons, random(0, icons.length-1));
        for (let r = 1; r <= HEIGHT; r++) {
            let row = `<div class="tree-row" id="row-${r}">`;
            let n = Math.trunc(r * F) + 1;
            let w = 6 * r * F / n;
            row += `<i id="ball-${r}-0" class="ball fas ${nextIcon()}"></i>`
            for (let i = 1; i <= n; i++) {
                let btn = `<button id="btn-${r}-${i}" type="button" style="width: ${w}rem" disabled class="tree-btn btn">`
                btn += `${pickRandom(labels)}`
                btn += `</button>`;
                row += btn + `<i id="ball-${r}-${i}" class="ball fas ${nextIcon()}"></i>`;
            }
            row += '</div>';
            html += row;
        }
        html += `<button type="button" style="width: 3rem" disabled class="stem-btn btn">&nbsp;</button>`
        html += `<button type="button" style="width: 3rem" disabled class="stem-btn btn">&nbsp;</button>`
        //html += `<button type="button" style="width: 3rem" disabled class="stem-btn btn">&nbsp;</button>`
        return html;
    }

    function makeCat($t) {
        const g = document.createElement('i');
        g.className = 'cat fas fa-cat';
        g.style.position = 'absolute';
        g.style.bottom = '0';
        g.style.left = '' + ($t.offsetWidth / 3) + 'px';
        return g;
    }

    function makeGift($t) {
        const g = document.createElement('i');
        g.className = 'gift fas fa-gift';
        g.style.position = 'absolute';
        g.style.bottom = '0';
        g.style.left = '' + ($t.offsetWidth * 2 / 3) + 'px';
        return g;
    }

    const $tree = document.getElementById('tree');

    window.addEventListener('load', function() {
            $tree.innerHTML = generateTreeHtml();
            $tree.addEventListener('click', (e) => {
                //console.log(e);
                if (e.target.tagName.toUpperCase() === 'BUTTON') {
                    wish(e.x, e.y, nextWish());
                    e.preventDefault();
                    e.stopPropagation();
                }
            })
        }
    );

    function lightBanner() {
        const banner = document.getElementById('banner');
        banner.classList.remove('invisible');
    }

    function lightStar() {
        $tree.querySelector('#star').classList.add('star-glow');
    }

    function lightTree() {
        //document.body.classList.toggle('body-ani');
        $tree.querySelectorAll('.tree-btn').forEach(b => {
            b.removeAttribute('disabled');
            b.classList.add('btn-success');
        });
        $tree.querySelectorAll('.stem-btn').forEach(b => {
            b.removeAttribute('disabled');
        });
    }

    const effects = [ballsSequenceLightEffect, ballsRowCycleLightEffect, ballsRandomAllLightEffect, ballsRandomRowLightEffect];
    const nextEffect = pickCycle(effects);

    function lightBalls() {
        let timer = nextEffect()();
        setInterval(() => {
            clearInterval(timer);
            timer = nextEffect()();
        }, 8000);
    }

    function ballsSequenceLightEffect() {
        return setInterval(() => {
            const ball = nextBall();
            $tree.querySelectorAll('.ball').forEach(b => {
                b.classList.remove(...balls);
                b.classList.add(ball)
            })
        }, random(250, 350));
    }

    function ballsRandomAllLightEffect() {
        return setInterval(() => {
            $tree.querySelectorAll('.ball').forEach(b => {
                b.classList.remove(...balls);
                b.classList.add(pickRandom(balls))
            })
        }, random(150, 250));
    }

    function ballsRandomRowLightEffect() {
        return setInterval(() => {
            $tree.querySelectorAll('.tree-row').forEach(r => {
                const c = pickRandom(balls);
                r.querySelectorAll('.ball').forEach(b => {
                    b.classList.remove(...balls);
                    b.classList.add(c)
                });
            })
        }, random(150, 250));
    }

    function ballsRowCycleLightEffect() {
        return setInterval(() => {
            $tree.querySelectorAll('.tree-row').forEach((r, i) => {
                const ball = nextBall();
                r.querySelectorAll('.ball').forEach(b => {
                    b.classList.remove(...balls);
                    b.classList.add(ball)
                });
            })
        }, random(150, 250));
    }

    function wish(x, y, text) {
        const el = document.createElement('div');
        el.className = 'wish';
        el.innerHTML = text;
        el.style.top = `${y}px`;
        el.style.left = `${x}px`;
        document.body.appendChild(el);
        setTimeout(() => document.body.removeChild(el), 1200);
    }

    async function light() {
        document.getElementById('control').classList.add('d-none');
        lightTree();
        await delay(600);
        lightStar();
        await delay(600);
        $tree.appendChild(makeGift($tree));
        await delay(500);
        $tree.appendChild(makeCat($tree));
        await delay(500);
        lightBalls();
        await delay(300);
        lightBanner();
        await delay(300);
        document.getElementById('year').classList.remove('d-none');
    }

</script>
</body>
</html>
